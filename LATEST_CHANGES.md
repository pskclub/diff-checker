# ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î - PDF Support

## üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: 2025-11-10

---

## ‚úÖ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥

### 1. ‡∏•‡∏ö Page Break Markers

**‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤:**
```
Page 1 content...

--- Page Break ---

Page 2 content...

--- Page Break ---

Page 3 content...
```

**‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
```
Page 1 content...

Page 2 content...

Page 3 content...
```

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:**
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô
- ‡πÑ‡∏°‡πà‡∏°‡∏µ noise ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
- ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏°‡∏µ blank lines ‡∏Ñ‡∏±‡πà‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ (2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- `app/TextDiffChecker.tsx` (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 285-286)

**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:**
```typescript
// ‡πÄ‡∏î‡∏¥‡∏°
return textPages.join('\n\n--- Page Break ---\n\n');

// ‡πÉ‡∏´‡∏°‡πà
return textPages.join('\n\n');
```

---

## üîß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Worker Configuration

### 2. Hybrid Worker Loading (Local + CDN Fallback)

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ:**
```
Setting up fake worker failed: "Failed to fetch dynamically imported module: 
http://cdnjs.cloudflare.com/ajax/libs/pdf.js/5.4.296/pdf.worker.min.js"
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**

#### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Copy Script
‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `scripts/copy-pdf-worker.js`:
```javascript
const fs = require('fs');
const path = require('path');

const source = path.join(__dirname, '../node_modules/pdfjs-dist/build/pdf.worker.min.mjs');
const dest = path.join(publicDir, 'pdf.worker.min.mjs');

fs.copyFileSync(source, dest);
```

#### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏û‡∏¥‡πà‡∏° Script ‡πÉ‡∏ô package.json
```json
{
  "scripts": {
    "postinstall": "node scripts/copy-pdf-worker.js",
    "copy-worker": "node scripts/copy-pdf-worker.js"
  }
}
```

#### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: Hybrid Worker Loading
```typescript
// ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ local worker ‡∏Å‡πà‡∏≠‡∏ô
const localWorker = '/pdf.worker.min.mjs';
const cdnWorker = `https://unpkg.com/pdfjs-dist@${pdfjsLib.version}/build/pdf.worker.min.mjs`;

try {
  const response = await fetch(localWorker, { method: 'HEAD' });
  if (response.ok) {
    pdfjsLib.GlobalWorkerOptions.workerSrc = localWorker;
  } else {
    pdfjsLib.GlobalWorkerOptions.workerSrc = cdnWorker;
  }
} catch {
  pdfjsLib.GlobalWorkerOptions.workerSrc = cdnWorker;
}
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‚ö° ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ (‡πÉ‡∏ä‡πâ local worker)
- üîí ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ (‡∏°‡∏µ CDN fallback)
- üì¶ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ external CDN ‡πÄ‡∏™‡∏°‡∏≠
- ‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ offline (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ local worker)

#### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï .gitignore
```
# PDF.js worker (generated by postinstall script)
public/pdf.worker.min.mjs
```

---

## üì¶ Dependencies

### ‡πÄ‡∏û‡∏¥‡πà‡∏°
```json
{
  "dependencies": {
    "pdfjs-dist": "^5.4.394"
  },
  "devDependencies": {
    "@types/pdfjs-dist": "^2.10.377"
  }
}
```

### ‡∏•‡∏ö
```json
{
  "dependencies": {
    "pdf-parse": "^2.4.5"  // ‚ùå ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
  }
}
```

---

## üéØ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- ‚ùå Worker loading error
- ‚ùå ‡πÉ‡∏ä‡πâ HTTP (mixed content warning)
- ‚ùå ‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ CDN ‡πÄ‡∏™‡∏°‡∏≠
- ‚ùå ‡∏°‡∏µ page break markers

### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- ‚úÖ Worker loading ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
- ‚úÖ ‡πÉ‡∏ä‡πâ HTTPS
- ‚úÖ ‡πÉ‡∏ä‡πâ local worker (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤)
- ‚úÖ ‡∏°‡∏µ CDN fallback (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ)
- ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ page break markers (‡∏™‡∏∞‡∏≠‡∏≤‡∏î)

---

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Worker Loading

1. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ worker file ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà:**
   ```bash
   ls public/pdf.worker.min.mjs
   ```

2. **‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô:**
   ```bash
   npm run copy-worker
   ```

3. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå:**
   ```bash
   # ‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 1 MB
   du -h public/pdf.worker.min.mjs
   ```

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö PDF Extraction

1. **‡πÄ‡∏õ‡∏¥‡∏î Browser DevTools**
2. **‡πÑ‡∏õ‡∏ó‡∏µ‡πà Console tab**
3. **‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå PDF**
4. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ errors**
5. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
   - ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ "--- Page Break ---"
   - ‚úÖ ‡∏°‡∏µ blank lines ‡∏Ñ‡∏±‡πà‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤
   - ‚úÖ Layout ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

---

## üìä ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö

### Page Break Handling

| ‡∏î‡πâ‡∏≤‡∏ô | ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ | ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ |
|------|---------|--------|
| Page separator | `--- Page Break ---` | ‡πÑ‡∏°‡πà‡∏°‡∏µ |
| Blank lines | 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î |
| ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |

### Worker Loading

| ‡∏î‡πâ‡∏≤‡∏ô | ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ | ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ |
|------|---------|--------|
| Source | CDN only | Local + CDN |
| ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Offline support | ‚ùå | ‚úÖ |

---

## üöÄ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### Development

```bash
# 1. Install dependencies (‡∏à‡∏∞‡∏£‡∏±‡∏ô postinstall ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
npm install

# 2. Start dev server
npm run dev

# 3. ‡πÄ‡∏õ‡∏¥‡∏î browser ‡∏ó‡∏µ‡πà http://localhost:3000
```

### Production

```bash
# 1. Build
npm run build

# 2. Start production server
npm start
```

### Manual Worker Copy (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)

```bash
npm run copy-worker
```

---

## üìù ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

### Modified Files

1. **app/TextDiffChecker.tsx**
   - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô worker loading ‡πÄ‡∏õ‡πá‡∏ô hybrid approach
   - ‡∏•‡∏ö page break markers

2. **package.json**
   - ‡πÄ‡∏û‡∏¥‡πà‡∏° `pdfjs-dist` dependency
   - ‡πÄ‡∏û‡∏¥‡πà‡∏° `postinstall` ‡πÅ‡∏•‡∏∞ `copy-worker` scripts

3. **.gitignore**
   - ‡πÄ‡∏û‡∏¥‡πà‡∏° `public/pdf.worker.min.mjs`

### New Files

1. **scripts/copy-pdf-worker.js**
   - Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö copy worker file

2. **public/pdf.worker.min.mjs** (generated)
   - PDF.js worker file

### Documentation Files

1. **PDF_IMPROVEMENTS.md** - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ
2. **CHANGELOG_TH.md** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
3. **PDF_USAGE_GUIDE.md** - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
4. **WORKER_FIX.md** - ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç worker issues
5. **README_PDF_FEATURES.md** - ‡∏™‡∏£‡∏∏‡∏õ PDF features
6. **LATEST_CHANGES.md** - ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ)

---

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

### 1. Worker File Size

Worker file ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **1 MB**:
- ‚úÖ ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£ commit ‡πÉ‡∏ô git (‡πÉ‡∏ä‡πâ postinstall generate)
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÉ‡∏ô `.gitignore`
- ‚úÖ ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å generate ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠ `npm install`

### 2. Version Matching

Worker version ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö `pdfjs-dist` version:
- ‚úÖ ‡πÉ‡∏ä‡πâ dynamic version: `pdfjs-dist@${pdfjsLib.version}`
- ‚úÖ Postinstall script ‡∏à‡∏∞ copy version ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‚ö†Ô∏è ‡∏ñ‡πâ‡∏≤ update `pdfjs-dist` ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô `npm run copy-worker` ‡πÉ‡∏´‡∏°‡πà

### 3. CDN Fallback

‡∏ñ‡πâ‡∏≤ local worker ‡πÑ‡∏°‡πà‡∏°‡∏µ ‡∏à‡∏∞‡πÉ‡∏ä‡πâ CDN:
- ‚úÖ ‡πÉ‡∏ä‡πâ unpkg.com (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ)
- ‚úÖ ‡πÉ‡∏ä‡πâ HTTPS (‡πÑ‡∏°‡πà‡∏°‡∏µ mixed content warning)
- ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ internet connection

---

## üéâ ‡∏™‡∏£‡∏∏‡∏õ

### ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

1. ‚úÖ **‡∏•‡∏ö page break markers** - ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
2. ‚úÖ **Hybrid worker loading** - ‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ
3. ‚úÖ **Local worker support** - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ CDN
4. ‚úÖ **CDN fallback** - ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
5. ‚úÖ **Automated setup** - postinstall script
6. ‚úÖ **Better error handling** - ‡∏°‡∏µ fallback mechanism

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

**PDF extraction ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:**
- ‚ö° ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô (‡πÉ‡∏ä‡πâ local worker)
- üîí ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô (‡∏°‡∏µ fallback)
- üìÑ ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ page break markers)
- ‚ú® ‡∏£‡∏±‡∏Å‡∏©‡∏≤ layout ‡πÑ‡∏î‡πâ‡∏î‡∏µ
- üéØ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô production

**‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß!** üöÄ

