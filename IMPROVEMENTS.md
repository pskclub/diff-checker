# การปรับปรุง Diff Checker ให้ใกล้เคียง Git มากขึ้น

## สรุปการปรับปรุง

### 1. **ใช้ Myers Diff Algorithm แทน LCS แบบธรรมดา**
   - **เหตุผล**: Myers algorithm เป็นอัลกอริทึมที่ Git ใช้จริง ให้ผลลัพธ์ที่แม่นยำและเป็นธรรมชาติมากกว่า
   - **ประโยชน์**:
     - ลดจำนวน hunks ที่ไม่จำเป็น
     - จัดกลุ่มการเปลี่ยนแปลงได้ดีกว่า
     - ประสิทธิภาพดีกว่าในกรณีที่มีการเปลี่ยนแปลงมาก

### 2. **ปรับปรุงการตรวจจับ Modified Lines**
   - **เพิ่ม Similarity Threshold (40%)**:
     - บรรทัดที่มีความคล้ายกันมากกว่า 40% จะถูกจัดเป็น "modified"
     - บรรทัดที่แตกต่างกันมากจะแสดงแยกเป็น "removed" และ "added"
   - **ประโยชน์**:
     - ลดความสับสนเมื่อบรรทัดถูกเขียนใหม่ทั้งหมด
     - แสดงการเปลี่ยนแปลงที่แท้จริงได้ชัดเจนขึ้น

### 3. **ปรับปรุงการจัดกลุ่ม Hunks**
   - **Context Size**: 3 บรรทัด (เหมือน git default)
   - **Merge Distance**: 6 บรรทัด
     - Hunks ที่อยู่ห่างกันไม่เกิน 6 บรรทัดจะถูกรวมเป็น hunk เดียว
   - **ประโยชน์**:
     - ลดจำนวน hunks ที่แสดง
     - ง่ายต่อการอ่านและเข้าใจ
     - ใกล้เคียงกับพฤติกรรมของ git diff

### 4. **ปรับปรุง Hunk Header**
   - **รูปแบบ**: `@@ -start1,count1 +start2,count2 @@`
   - **แสดงข้อมูล**:
     - เลขบรรทัดเริ่มต้นของแต่ละไฟล์
     - จำนวนบรรทัดทั้งหมดใน hunk (รวม context)
   - **ประโยชน์**:
     - เหมือนกับ git diff ทุกประการ
     - ง่ายต่อการเข้าใจตำแหน่งของการเปลี่ยนแปลง

### 5. **ปรับปรุงการจัดการ Empty Lines**
   - **เก็บ empty lines ไว้ทั้งหมด** (ไม่ filter ออก)
   - **ประโยชน์**:
     - แสดงการเปลี่ยนแปลงของ whitespace ได้ถูกต้อง
     - เลขบรรทัดตรงกับไฟล์ต้นฉบับ
     - ตรวจจับการเพิ่ม/ลบบรรทัดว่างได้

### 6. **ปรับปรุง Character-level Diff**
   - **ใช้ Myers algorithm สำหรับ character diff ด้วย**
   - **ประโยชน์**:
     - แสดงความแตกต่างในระดับตัวอักษรได้แม่นยำขึ้น
     - ลดการ highlight ที่ไม่จำเป็น
     - ง่ายต่อการมองเห็นว่าเปลี่ยนอะไรบ้าง

### 7. **แสดงเลขบรรทัดที่ถูกต้อง**
   - **ใช้ originalLineNum แทน lineNum**
   - **ประโยชน์**:
     - เลขบรรทัดตรงกับไฟล์ต้นฉบับ
     - สามารถกระโดดไปยังบรรทัดที่ถูกต้องได้
     - ไม่สับสนเมื่อมีการ filter บรรทัด

## การเปรียบเทียบกับ Git

| คุณสมบัติ | ก่อนปรับปรุง | หลังปรับปรุง | Git |
|-----------|-------------|-------------|-----|
| Algorithm | LCS | Myers | Myers ✓ |
| Context Lines | 3 | 3 | 3 ✓ |
| Hunk Merging | ไม่มี | 6 lines | ~7 lines ✓ |
| Modified Detection | Simple | Similarity-based | Similarity-based ✓ |
| Hunk Header | Simple | Git-style | Git-style ✓ |
| Empty Lines | Filtered | Kept | Kept ✓ |
| Line Numbers | Filtered | Original | Original ✓ |

## ตัวอย่างการใช้งาน

### ก่อนปรับปรุง:
```
@@ 5 @@
- old line
+ new line
@@ 10 @@
- another old
+ another new
```

### หลังปรับปรุง:
```
@@ -5,8 +5,8 @@
 context line 1
 context line 2
 context line 3
-old line
+new line
 context line 4
 context line 5
 context line 6
-another old
+another new
 context line 7
```

## ข้อดีของการปรับปรุง

1. **ความแม่นยำสูงขึ้น**: ใช้อัลกอริทึมเดียวกับ git
2. **อ่านง่ายขึ้น**: จัดกลุ่ม hunks ได้ดีกว่า
3. **ข้อมูลครบถ้วน**: แสดง context และเลขบรรทัดที่ถูกต้อง
4. **ประสิทธิภาพดีขึ้น**: Myers algorithm มีประสิทธิภาพดีกว่า LCS ในหลายกรณี
5. **ใกล้เคียง git มากที่สุด**: พฤติกรรมเหมือน git diff

## การทดสอบ

แนะนำให้ทดสอบกับ:
1. ไฟล์ที่มีการเปลี่ยนแปลงเล็กน้อย
2. ไฟล์ที่มีการเปลี่ยนแปลงมาก
3. ไฟล์ที่มี empty lines จำนวนมาก
4. ไฟล์ที่มีการเปลี่ยน whitespace
5. ไฟล์ที่มีบรรทัดที่คล้ายกันมาก

### 8. **เพิ่มตัวเลือก Ignore Empty Lines**
   - **Checkbox ใหม่**: "Ignore empty lines"
   - **การทำงาน**:
     - เมื่อเปิด: กรองบรรทัดว่างออกก่อนเปรียบเทียบ
     - เมื่อปิด: เก็บบรรทัดว่างไว้ทั้งหมด (default)
   - **ประโยชน์**:
     - ลดความสับสนเมื่อมีการเพิ่ม/ลบบรรทัดว่าง
     - มีประโยชน์เมื่อเปรียบเทียบโค้ดที่มี formatting ต่างกัน
     - ยืดหยุ่นตามความต้องการของผู้ใช้
   - **บันทึกใน Session**: ตั้งค่านี้จะถูกบันทึกและโหลดกลับมาได้

## สรุป

การปรับปรุงนี้ทำให้ Diff Checker มีคุณภาพใกล้เคียง git diff มากที่สุด โดยใช้อัลกอริทึมและเทคนิคเดียวกัน ผลลัพธ์ที่ได้จะแม่นยำ อ่านง่าย และเป็นมาตรฐานเดียวกับที่นักพัฒนาคุ้นเคย

นอกจากนี้ยังมีความยืดหยุ่นเพิ่มเติมด้วยตัวเลือก "Ignore empty lines" ที่ช่วยให้ผู้ใช้สามารถเลือกได้ว่าต้องการเห็นการเปลี่ยนแปลงของบรรทัดว่างหรือไม่

